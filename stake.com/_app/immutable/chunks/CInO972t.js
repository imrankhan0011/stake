import{w as h,g as o,d as c}from"./Bhbbb5KL.js";import{aG as f}from"./jOU3gvjy.js";import{c as g,l as k}from"./BnZzCvUo.js";import{b as C}from"./DaVVfAvY.js";import{r as R}from"./DlWQCp_y.js";import{p as w}from"./rq92GsuN.js";import{f as v}from"./B2iWwL45.js";import{c as A}from"./ejVo6ovo.js";import{s as P}from"./D55SFQxC.js";function q(r,n){return r?r==="swish"||r==="customSwish"?"swish":r==="customSportBet"?"betradar":r==="racingBet"||r==="racingExoticBet"?"racing":n:null}const G=10,L=g("quick_bet_popup",!1),S=/(\d+(\.\d+)?(e[+-]?\d+)?)(?=\s*$)/,V=(r,n)=>{var t;const e=(t=r==null?void 0:r.match(S))==null?void 0:t[0];return C(Number(e),n,"floor")},x=r=>{var e;return!!((e=r==null?void 0:r.match(S))==null?void 0:e[0])},u=(()=>{const r=sessionStorage.getItem("betPrePlacementStore"),n=h(r?JSON.parse(r):[]);return{subscribe:n.subscribe,addBet:async e=>{o(n).some(t=>t.response)&&(n.update(t=>t.filter(s=>s.id!==e.id)),await f()),n.update(t=>[...t,e].filter(s=>!s.response))},updateStake:(e,t)=>{n.update(s=>s.map(a=>a.id===e?{...a,stake:t}:a))},updateStakePerCombo:(e,t)=>{n.update(s=>s.map(a=>a.id===e?{...a,stakePerCombo:t}:a))},updateOdds:(e,t,s)=>n.update(a=>a.map(i=>i.id===e?{...i,odds:s?i.odds:t,eachWayOdds:s&&i.type==="racingBet"?t:i.type==="racingBet"?i.eachWayOdds:0}:i)),updateSessionId:(e,t)=>n.update(s=>s.map(a=>a.id===e?{...a,sessionId:t}:a)),acceptNewOdds:()=>n.update(e=>e.map(t=>({...t,acceptedOdds:t.odds||0}))),toggleEachWay:({id:e,eachWayOdds:t})=>{n.update(s=>s.map(a=>a.type==="racingBet"&&a.id===e?{...a,eachWay:!a.eachWay,eachWayOdds:t,eachWayAcceptedOdds:t}:a))},updateFetchingStatus:(e,t)=>{n.update(s=>s.map(a=>a.id===e?{...a,fetching:t}:a))},updateResponse:(e,t)=>{var a,i,d;const s=Number((d=(i=(a=t.error)==null?void 0:a.message)==null?void 0:i.match(S))==null?void 0:d[0]);s&&u.updateStake(e,s),n.update(l=>l.map(p=>p.id===e?{...p,response:t}:p))},updateAllResponses:e=>{n.update(t=>t.map(s=>({...s,response:e})))},repeatStake:async e=>{const t=o(n),s=t.find(a=>a.id===e);s&&t.forEach(a=>u.updateStake(a.id,s==null?void 0:s.stake))},removeBet:e=>{n.update(t=>t.filter(s=>s.id!==e))},removeAllBets:()=>{n.set([])},removeResolvedBets:()=>{n.update(e=>e.filter(t=>!t.response))},shouldResetBetsAfterCompletion:(e=null)=>{const t=o(n),s=e!==null,a=t.some(i=>i.response);return s||a},resetBets:()=>{n.update(e=>e.map(t=>({...t,eachWay:!1})))},retainFailedBets:async()=>{const e=o(n).filter(t=>{var s;return(s=t.response)==null?void 0:s.error}).map(t=>({...t,response:void 0}));u.removeAllBets(),await f(),n.set(e)},retainAllBets:async()=>{const e=o(n).map(t=>({...t,response:void 0}));u.removeAllBets(),await f(),n.set(e)},updateBetInvalidation:(e,t)=>{n.update(s=>s.map(a=>a.id===e?{...a,invalidBet:t}:a))},updateLeg:(e,t,s)=>{n.update(a=>a.map(i=>(i.type==="customSwish"&&i.id===e&&i.sameGameMultiOutcomes.map(d=>(d.marketId===t&&(d.suspended=s),d)),i)))}}})();u.subscribe(r=>{sessionStorage.setItem("betPrePlacementStore",JSON.stringify(r))});const B=k("oddsChange",R.none),J=(()=>{const r=h({activePanel:"betSlip",showConfirmationStep:!1,oddsChangeCondition:o(B),totalStake:c(u,e=>e.reduce((t,s)=>s.type==="racingBet"&&s.eachWay?t+(s.stake||0)*2:t+(s.stake||0),0)),totalOdds:c(u,e=>e.reduce((t,s)=>s.type==="racingBet"&&s.startingPriceMarket?t:t*(s.odds||1),1)),multiStake:0,fetching:c(u,e=>e.some(t=>t.fetching)),submitting:!1,multiResponse:null});{let e=0;u.subscribe(t=>{const s=window.innerWidth>=A.sidebarFullWidth,a=t.length;a!==e&&(o(r).submitting||r.update(i=>({...i,...a>0&&{activePanel:"betSlip"},multiResponse:null})),s&&a>0&&P.set("betslip")),e=a})}const n=()=>{!o(r).submitting&&u.shouldResetBetsAfterCompletion(o(r).multiResponse)&&(r.update(e=>({...e,multiResponse:null,multiStake:0})),u.removeAllBets())};return{subscribe:r.subscribe,updateOddsCondition:e=>{r.update(t=>({...t,oddsChangeCondition:e})),B.set(e)},updateMultiStake:e=>{r.update(t=>({...t,multiStake:e}))},resetConfirmationStep:()=>{r.update(e=>({...e,showConfirmationStep:!1}))},requireConfirmationStep:()=>{var i,d,l,p;const e=o(r),t=o(w),s=o(v),a=o((i=t.data)==null?void 0:i.userPreferences);return!((l=(d=s.sports_bet_confirmation_flag)==null?void 0:d.config)!=null&&l.enabled)||(p=a==null?void 0:a.user)!=null&&p.preference.noBetConfirmation?!1:e.showConfirmationStep===!1?(r.update(m=>({...m,showConfirmationStep:!0})),!0):(r.update(m=>({...m,showConfirmationStep:!1})),!1)},updateSubmissionStatus:e=>{r.update(t=>({...t,submitting:e,showConfirmationStep:!1}))},updatePanel:e=>{n(),r.update(t=>({...t,activePanel:e}))},updateMultiResponse:e=>{r.update(t=>({...t,multiResponse:e}))},clearMultiResponse:()=>{r.update(e=>({...e,multiResponse:null}))},retainMultiBet:()=>{r.update(e=>({...e,multiResponse:null}))},resetMultiBet:()=>{r.update(e=>({...e,multiResponse:null,multiStake:0})),u.removeAllBets()},resetBetsAfterCompletion:n}})();export{G as M,S as R,u as a,J as b,q as c,V as g,x as i,L as q};
