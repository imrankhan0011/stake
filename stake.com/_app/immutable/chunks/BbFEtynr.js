import{i as j}from"./-2c5L_R-.js";import{d as q}from"./BS6f7dTc.js";import{e as $}from"./CH8lUi8C.js";import{g as F}from"./Rp-a9zkb.js";import{u as E}from"./Bh4jp7by.js";import{v as K}from"./CFyBPWZT.js";import{D as N}from"./BV84Ne7d.js";import{r as V}from"./C72j1-7g.js";import{g as D}from"./CLgR3Pi3.js";import{o as X}from"./CQrL6g3R.js";import{_ as Y,h as J,g as z,b as I,o as O,c as k,a as m,O as b,j as B,r as ee,k as re,l as ne,m as te,n as oe,p as ie,q as ae,s as se,t as M,d as ue,e as fe,u as ce,v as P}from"./CfTKU0o5.js";import{p as S}from"./DV_bOSsD.js";var le=function(e){Y(r,e);function r(t,n,o){t===void 0&&(t=1/0),n===void 0&&(n=1/0),o===void 0&&(o=z);var i=e.call(this)||this;return i._bufferSize=t,i._windowTime=n,i._timestampProvider=o,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=n===1/0,i._bufferSize=Math.max(1,t),i._windowTime=Math.max(1,n),i}return r.prototype.next=function(t){var n=this,o=n.isStopped,i=n._buffer,s=n._infiniteTimeWindow,a=n._timestampProvider,u=n._windowTime;o||(i.push(t),!s&&i.push(a.now()+u)),this._trimBuffer(),e.prototype.next.call(this,t)},r.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var n=this._innerSubscribe(t),o=this,i=o._infiniteTimeWindow,s=o._buffer,a=s.slice(),u=0;u<a.length&&!t.closed;u+=i?1:2)t.next(a[u]);return this._checkFinalizedStatuses(t),n},r.prototype._trimBuffer=function(){var t=this,n=t._bufferSize,o=t._timestampProvider,i=t._buffer,s=t._infiniteTimeWindow,a=(s?1:2)*n;if(n<1/0&&a<i.length&&i.splice(0,i.length-a),!s){for(var u=o.now(),l=0,f=1;f<i.length&&i[f]<=u;f+=2)l=f;l&&i.splice(0,l+1)}},r}(J);function de(e){return e&&I(e.schedule)}function A(e){return e[e.length-1]}function Fe(e){return I(A(e))?e.pop():void 0}function ve(e){return de(A(e))?e.pop():void 0}function Ne(e,r){return typeof A(e)=="number"?e.pop():r}function v(e,r,t,n,o){n===void 0&&(n=0),o===void 0&&(o=!1);var i=r.schedule(function(){t(),o?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(i),!o)return i}function W(e,r){return r===void 0&&(r=0),O(function(t,n){t.subscribe(k(n,function(o){return v(n,e,function(){return n.next(o)},r)},function(){return v(n,e,function(){return n.complete()},r)},function(o){return v(n,e,function(){return n.error(o)},r)}))})}function Q(e,r){return r===void 0&&(r=0),O(function(t,n){n.add(e.schedule(function(){return t.subscribe(n)},r))})}function me(e,r){return m(e).pipe(Q(r),W(r))}function be(e,r){return m(e).pipe(Q(r),W(r))}function he(e,r){return new b(function(t){var n=0;return r.schedule(function(){n===e.length?t.complete():(t.next(e[n++]),t.closed||this.schedule())})})}function pe(e,r){return new b(function(t){var n;return v(t,r,function(){n=e[B](),v(t,r,function(){var o,i,s;try{o=n.next(),i=o.value,s=o.done}catch(a){t.error(a);return}s?t.complete():t.next(i)},0,!0)}),function(){return I(n==null?void 0:n.return)&&n.return()}})}function U(e,r){if(!e)throw new Error("Iterable cannot be null");return new b(function(t){v(t,r,function(){var n=e[Symbol.asyncIterator]();v(t,r,function(){n.next().then(function(o){o.done?t.complete():t.next(o.value)})},0,!0)})})}function _e(e,r){return U(ee(e),r)}function ye(e,r){if(e!=null){if(re(e))return me(e,r);if(ne(e))return he(e,r);if(te(e))return be(e,r);if(oe(e))return U(e,r);if(ie(e))return pe(e,r);if(ae(e))return _e(e,r)}throw se(e)}function ge(e,r){return r?ye(e,r):m(e)}function Z(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=ve(e);return ge(e,t)}function R(e){return O(function(r,t){var n=null,o=!1,i;n=r.subscribe(k(t,void 0,void 0,function(s){i=m(e(s,R(e)(r))),n?(n.unsubscribe(),n=null,i.subscribe(t)):o=!0})),o&&(n.unsubscribe(),n=null,i.subscribe(t))})}function we(e){e===void 0&&(e={});var r=e.connector,t=r===void 0?function(){return new J}:r,n=e.resetOnError,o=n===void 0?!0:n,i=e.resetOnComplete,s=i===void 0?!0:i,a=e.resetOnRefCountZero,u=a===void 0?!0:a;return function(l){var f,c,d,p=0,_=!1,y=!1,g=function(){c==null||c.unsubscribe(),c=void 0},C=function(){g(),f=d=void 0,_=y=!1},H=function(){var h=f;C(),h==null||h.unsubscribe()};return O(function(h,L){p++,!y&&!_&&g();var w=d=d??t();L.add(function(){p--,p===0&&!y&&!_&&(c=T(H,u))}),w.subscribe(L),!f&&p>0&&(f=new M({next:function(x){return w.next(x)},error:function(x){y=!0,g(),c=T(C,o,x),w.error(x)},complete:function(){_=!0,g(),c=T(C,s),w.complete()}}),m(h).subscribe(f))})(l)}}function T(e,r){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];if(r===!0){e();return}if(r!==!1){var o=new M({next:function(){o.unsubscribe(),e()}});return m(r.apply(void 0,ue([],fe(t)))).subscribe(o)}}function xe(e,r,t){var n,o,i,s,a=!1;return e&&typeof e=="object"?(n=e.bufferSize,s=n===void 0?1/0:n,o=e.windowTime,r=o===void 0?1/0:o,i=e.refCount,a=i===void 0?!1:i,t=e.scheduler):s=e??1/0,we({connector:function(){return new le(s,r,t)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function G(e,r){r===void 0&&(r={});var t=r.selector,n=ce(r,["selector"]);return new b(function(o){var i=new AbortController,s=i.signal,a=!0,u=n.signal;if(u)if(u.aborted)i.abort();else{var l=function(){s.aborted||i.abort()};u.addEventListener("abort",l),o.add(function(){return u.removeEventListener("abort",l)})}var f=P(P({},n),{signal:s}),c=function(d){a=!1,o.error(d)};return fetch(e,f).then(function(d){t?m(t(d)).subscribe(k(o,void 0,function(){a=!1,o.complete()},c)):(a=!1,o.next(d),o.complete())}).catch(c),function(){a&&i.abort()}})}function De(e,r){X(()=>{const t=e.subscribe(r);return()=>{t.unsubscribe()}})}function Je(e){return{subscribe:r=>{const t=e.subscribe(r);return()=>{t.unsubscribe()}}}}function Me(e){const{doc:r}=e,t="variables"in e&&e.variables?e.variables:{},n=new Headers(N),o=D(),i=F();return o&&n.set("x-access-token",o),i&&n.set("x-language",i),G(E,{method:"POST",headers:n,body:JSON.stringify({query:S(r),variables:t}),selector:async s=>{if(s.status!==200)return{errors:[{message:j._("Failed to fetch - bad response")}],data:null,response:s};try{return await s.json()}catch{return{errors:[{message:j._("Failed to fetch")}],data:null,response:s}}}}).pipe(R(s=>Z({errors:[{message:s.message}],data:null})))}function We({load:e,doc:r,variables:t}){var i,s;const n=(i=r==null?void 0:r.definitions)==null?void 0:i[0],o="name"in n?(s=n.name)==null?void 0:s.value:void 0;return e||(e={fetch}),G(E,{method:"POST",headers:(()=>{const a=new Headers(N),u=D(),l=F();return u&&a.set("x-access-token",u),l&&a.set("x-language",l),a.set("x-operation-type","query"),o&&a.set("x-operation-name",o),a})(),body:JSON.stringify({query:S(r),variables:t}),selector:async a=>{if(!a.ok)return V(a),{data:null,errors:{networkError:a}};try{return await a.json()}catch{return{data:null,errors:{networkError:a}}}}}).pipe(R(a=>{const u={errorType:"load error",url:E,DOC_NAME:o,error:a instanceof Error?a.toString():"unknown fetch error",errorMessage:a instanceof Error?a.message:"no error message",cause:a instanceof Error?a.cause:"no cause"};return console.error(JSON.stringify(u)),Z({data:null,errors:{networkError:new Response(JSON.stringify(u),{status:500,statusText:"Server error"})}})}),a=>new b(u=>{const l=a.subscribe({next:f=>{"errors"in f&&f.errors&&Array.isArray(f.errors)&&f.errors.length&&(console.error(JSON.stringify({errorType:"api load error",url:E,errors:f.errors,query:S(r),variables:t})),f.errors.forEach(c=>{$.next({type:(c==null?void 0:c.errorType)||"errorExchange",error:c})})),u.next({data:f.data??null,errors:Array.isArray(f.errors)&&f.errors.length?{graphQLErrors:f.errors,networkError:void 0}:{graphQLErrors:[],networkError:void 0}}),u.complete()},error:f=>{u.next({data:null,errors:{networkError:f}}),u.complete()}});return()=>l.unsubscribe()}))}function Qe({query:e,variables:r}){return new b(t=>{const n=K.subscribe({query:S(e),variables:r},{error:o=>{t.error(o)},complete:()=>t.complete(),next:o=>{var i,s,a;if(t.next(o.data),o.errors&&q){const u=(a=(s=(i=e==null?void 0:e.definitions)==null?void 0:i[0])==null?void 0:s.name)==null?void 0:a.value;console.error(u,"next subscription error",r,o.errors)}}});return()=>{n()}})}function Ue(e){return e.pipe(xe({bufferSize:1,refCount:!0}))}function Ze({publishersMap:e,makePublisherFn:r,getEntityId:t}){return(n,o)=>{const i=t(n),s=e.get(i);if(s)return s;const a=r(n,o);return e.set(i,a),a}}export{R as a,Me as b,Qe as c,Je as d,v as e,ge as f,Ze as g,Ne as h,de as i,Fe as j,We as k,Z as o,ve as p,Ue as r,De as s};
