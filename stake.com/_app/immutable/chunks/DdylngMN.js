function I(e){for(var t=[],r=0;r<e.length;){var i=e[r];if(i==="*"||i==="+"||i==="?"){t.push({type:"MODIFIER",index:r,value:e[r++]});continue}if(i==="\\"){t.push({type:"ESCAPED_CHAR",index:r++,value:e[r++]});continue}if(i==="{"){t.push({type:"OPEN",index:r,value:e[r++]});continue}if(i==="}"){t.push({type:"CLOSE",index:r,value:e[r++]});continue}if(i===":"){for(var y="",a=r+1;a<e.length;){var o=e.charCodeAt(a);if(o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122||o===95){y+=e[a++];continue}break}if(!y)throw new TypeError("Missing parameter name at ".concat(r));t.push({type:"NAME",index:r,value:y}),r=a;continue}if(i==="("){var f=1,c="",a=r+1;if(e[a]==="?")throw new TypeError('Pattern cannot start with "?" at '.concat(a));for(;a<e.length;){if(e[a]==="\\"){c+=e[a++]+e[a++];continue}if(e[a]===")"){if(f--,f===0){a++;break}}else if(e[a]==="("&&(f++,e[a+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(a));c+=e[a++]}if(f)throw new TypeError("Unbalanced pattern at ".concat(r));if(!c)throw new TypeError("Missing pattern at ".concat(r));t.push({type:"PATTERN",index:r,value:c}),r=a;continue}t.push({type:"CHAR",index:r,value:e[r++]})}return t.push({type:"END",index:r,value:""}),t}function S(e,t){t===void 0&&(t={});for(var r=I(e),i=t.prefixes,y=i===void 0?"./":i,a=t.delimiter,o=a===void 0?"/#?":a,f=[],c=0,E=0,v="",n=function(p){if(E<r.length&&r[E].type===p)return r[E++].value},h=function(p){var u=n(p);if(u!==void 0)return u;var l=r[E],C=l.type,D=l.index;throw new TypeError("Unexpected ".concat(C," at ").concat(D,", expected ").concat(p))},x=function(){for(var p="",u;u=n("CHAR")||n("ESCAPED_CHAR");)p+=u;return p},m=function(p){for(var u=0,l=o;u<l.length;u++){var C=l[u];if(p.indexOf(C)>-1)return!0}return!1},w=function(p){var u=f[f.length-1],l=p||(u&&typeof u=="string"?u:"");if(u&&!l)throw new TypeError('Must have text between two parameters, missing text after "'.concat(u.name,'"'));return!l||m(l)?"[^".concat(b(o),"]+?"):"(?:(?!".concat(b(l),")[^").concat(b(o),"])+?")};E<r.length;){var d=n("CHAR"),T=n("NAME"),R=n("PATTERN");if(T||R){var s=d||"";y.indexOf(s)===-1&&(v+=s,s=""),v&&(f.push(v),v=""),f.push({name:T||c++,prefix:s,suffix:"",pattern:R||w(s),modifier:n("MODIFIER")||""});continue}var P=d||n("ESCAPED_CHAR");if(P){v+=P;continue}v&&(f.push(v),v="");var N=n("OPEN");if(N){var s=x(),M=n("NAME")||"",A=n("PATTERN")||"",O=x();h("CLOSE"),f.push({name:M||(A?c++:""),pattern:M&&!A?w(s):A,prefix:s,suffix:O,modifier:n("MODIFIER")||""});continue}h("END")}return f}function H(e,t){return F(S(e,t),t)}function F(e,t){t===void 0&&(t={});var r=L(t),i=t.encode,y=i===void 0?function(c){return c}:i,a=t.validate,o=a===void 0?!0:a,f=e.map(function(c){if(typeof c=="object")return new RegExp("^(?:".concat(c.pattern,")$"),r)});return function(c){for(var E="",v=0;v<e.length;v++){var n=e[v];if(typeof n=="string"){E+=n;continue}var h=c?c[n.name]:void 0,x=n.modifier==="?"||n.modifier==="*",m=n.modifier==="*"||n.modifier==="+";if(Array.isArray(h)){if(!m)throw new TypeError('Expected "'.concat(n.name,'" to not repeat, but got an array'));if(h.length===0){if(x)continue;throw new TypeError('Expected "'.concat(n.name,'" to not be empty'))}for(var w=0;w<h.length;w++){var d=y(h[w],n);if(o&&!f[v].test(d))throw new TypeError('Expected all "'.concat(n.name,'" to match "').concat(n.pattern,'", but got "').concat(d,'"'));E+=n.prefix+d+n.suffix}continue}if(typeof h=="string"||typeof h=="number"){var d=y(String(h),n);if(o&&!f[v].test(d))throw new TypeError('Expected "'.concat(n.name,'" to match "').concat(n.pattern,'", but got "').concat(d,'"'));E+=n.prefix+d+n.suffix;continue}if(!x){var T=m?"an array":"a string";throw new TypeError('Expected "'.concat(n.name,'" to be ').concat(T))}}return E}}function b(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function L(e){return e&&e.sensitive?"":"i"}const g=new Map,_=1e4;function $(e){const t=g.get(e);if(t)return t;const r=H(e);if(g.size>=_){const i=g.keys().next().value;i&&g.delete(i)}return g.set(e,r),r}function U(e="/",t={}){return e==="/"?e:$(e)(t)}export{U as g};
